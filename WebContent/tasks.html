<!DOCTYPE html>
<!--[if IE 9 ]><html class="ie9"><![endif]-->
<head>

<title>Tasks</title>

<!-- CSS -->
<link href="/vertex/resources/css/bootstrap.min.css" rel="stylesheet">
<link href="/vertex/resources/css/animate.min.css" rel="stylesheet">
<link href="/vertex/resources/css/font-awesome.min.css" rel="stylesheet">
<link href="/vertex/resources/css/form.css" rel="stylesheet">
<link href="/vertex/resources/css/calendar.css" rel="stylesheet">
<link href="/vertex/resources/css/style.css" rel="stylesheet">
<link href="/vertex/resources/css/icons.css" rel="stylesheet">
<link href="/vertex/resources/css/generics.css" rel="stylesheet">
</head>
<body id="skin-blur-ocean">
	<header id="header" class="media">
		<a href="" id="menu-toggle"></a> <a class="logo pull-left"
			href="/vertex/index.html">Vertex Dashboard</a>

		<div class="media-body">
			<div class="media" id="top-menu">
				<div id="time" class="pull-right">
					<span id="hours"></span> : <span id="min"></span> : <span id="sec"></span>
				</div>
			</div>
		</div>
	</header>

	<div class="clearfix"></div>

	<section id="main" class="p-relative" role="main">

		<!-- Sidebar -->
		<aside id="sidebar">

			<!-- Sidbar Widgets -->
			<div class="side-widgets overflow">
				<!-- Profile Menu -->
				<div class="text-center s-widget m-b-25 dropdown" id="profile-menu">
					<a href="" data-toggle="dropdown"> <img
						class="profile-pic animated"
						src="/vertex/resources/img/profile-pics/male-user-icon.jpg" alt="">
					</a>
					<ul class="dropdown-menu profile-menu">
						<li><a href="/vertex/tasks.html">My Tasks</a> <i class="icon left">&#61903;</i><i
							class="icon right">&#61815;</i></li>
						<li><a href="/vertex/logout">Sign Out</a> <i
							class="icon left">&#61903;</i><i class="icon right">&#61815;</i></li>
					</ul>
					<h4 id="userFullName" class="m-0"></h4>
				</div>

				<div class="s-widgets">
					<div class="m-5">
						<a href="#compose-message" data-toggle="modal"
							class="btn btn-sm btn-block">Compose Message</a>
					</div>


					<div class="list-group list-group-flat m-t-15">
						<a class="list-group-item active">Tasks<span id="tasksCount"
							class="badge badge-trp">X</span></a> 
							<a href="#" class="list-group-item"><span class="message-tag progress-bar-info"></span>In Progress</a>
							<a href="#" class="list-group-item"><span class="message-tag progress-bar-success"></span>Resolved</a>
							<a href="#" class="list-group-item"><span class="message-tag progress-bar-danger"></span>Blocked</a>
							<a href="#" class="list-group-item"><span class="message-tag progress-bar-warning"></span>Accepted</a>
					</div>

				</div>
			</div>

			<!-- Side Menu -->
			<ul class="list-unstyled side-menu">
				<li class="active"><a class="sa-side-home" href="index.html">
						<span class="menu-item">Dashboard</span>
				</a></li>


			</ul>

		</aside>

		<!-- Content -->
		<section id="content" class="container">
		
            <div id="alert-area" class="alert alert-danger alert-dismissable fade in" hidden=true>
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
            </div>
		
			<div class="message-list list-container">
				<header class="listview-header media">
					<ul class="list-inline list-mass-actions pull-left">
						<li><a href="" title="Refresh" class="tooltips"> <i class="sa-list-refresh"></i></a></li>
					</ul>
					<ul id="page-custom-title" class="list-inline page-title b-0"><input class="list-inline input-sm col-md-4 pull-right message-search" type="text" placeholder="Search...."></ul>
					<div class="clearfix"></div>
				</header>
				<div id="tasklist"></div>
			</div>

		</section>
	</section>

	<!-- Javascript Libraries -->
	<!-- jQuery -->
	<script src="/vertex/resources/js/jquery.min.js"></script>
	<!-- jQuery Library -->

	<!-- Bootstrap -->
	<script src="/vertex/resources/js/bootstrap.min.js"></script>

	<!--  Form Related -->
	<script src="/vertex/resources/js/icheck.js"></script>
	<!-- Custom Checkbox + Radio -->

	<!-- Text Editor -->
	<script src="/vertex/resources/js/editor.min.js"></script>
	<!-- WYSIWYG Editor -->

	<!-- UX -->
	<script src="/vertex/resources/js/scroll.min.js"></script>
	<!-- Custom Scrollbar -->

	<!-- Other -->
	<script src="/vertex/resources/js/calendar.min.js"></script>
	<!-- Calendar -->
	<script src="/vertex/resources/js/feeds.min.js"></script>
	<!-- News Feeds -->


	<!-- All JS functions -->
	<script src="/vertex/resources/js/functions.js"></script>
	<script src="/vertex/resources/js/template.js"></script>

	<script type="text/javascript">
		$(document).ready(function() {
			getUser();
			getEvents();
			
			$.ajax({
				url : "/vertex/api/task/asignee/",
				type : "GET",
				success : function(jqXHR) {
					var tCount = jqXHR.length;
					showTasks("Assigned Tasks", jqXHR);
					$("#page-custom-title").append($("#userFullName").text() + "'s Tasks");
					$("#tasksCount").text(tCount);
				},
				error : function(jqXHR) {
					if (jqXHR.status == 404) {
						var html = '<div class="media"><p class="text-center media-body">You have no tasks yet.</p></div>';
							$('#tasklist').append(html);
							$("#tasksCount").text(0);
					}
				}
			});
		});

		function showTasks(tableTitle, tasks) {
			var taskhtml = '<div class="block-area" id="responsiveTable"><h3 class="block-title">' + tableTitle + '</h3>';
			taskhtml += '<div class="table-responsive overflow"><table class="table table-bordered table-hover tile"><thead><tr>';
			taskhtml += '<th>Status</th><th>Title</th><th>Created By</th><th>Date Greated</th><th>Last Updated</th>';
			taskhtml += '</tr></thead><tbody>';
			
			var ongoingTasks = [];
			
			for (index = 0; index < tasks.length; index++) {
				var task = tasks[index];
				taskhtml += '<tr><td>' + task.status + '</td>';
				taskhtml += '<td>' + task.title + '</td>';
				taskhtml += '<td>' + task.creator.fullName + '</td>';
				taskhtml += '<td>' + new Date(task.creationTime).toDateString() + '</td>';
				taskhtml += '<td>' + new Date(task.modificationTime).toDateString() + '</td></tr>';
				
				if (task.status === 'IN_PROGRESS') {
					ongoingTasks.push(task);
				}
			}
			
			taskhtml += '</tbody></table></div></div>';
			$('#tasklist').append(taskhtml);
			
			if (ongoingTasks.length >= 2) {
				$("#alert-area").append('You have ' + ongoingTasks.length + ' tasks in execution at the moment. Think about finishing them before accepting any more tasks.');
				$("#alert-area").show();
			}
		}
		
	</script>
</body>
</html>

